

# 医问 3.0 · A0（代码架构层）

## 健康数据模型的 **独立 Core Crate 设计说明**

> **本文档目的**
> 定义：医问 3.0 中，健康数据模型必须作为一个**独立、稳定、可复用的核心 crate**存在，
> 并明确这个 crate **负责什么 / 不负责什么**。
>
> 本文档解决的是：
> **“为什么数据模型不能写在业务里”**，而不是“数据库怎么建”。

---

## 1. 先给结论

医问 3.0 中：

> ✅ **健康数据模型必须实现为一个独立的 core crate**
> ✅ 任何业务（UI、API、分析、AI）都只能“使用”它，而不能“定义”它
> ❌ 不允许在业务 crate 中重新定义健康数据结构

这里的 **crate** 是一个抽象概念：

* 在 Rust 中是 crate
* 在其他语言中可以是：
  * 独立 package
  * 独立 module
  * 独立 domain library

核心原则不变：

> **数据模型是“被依赖的基础设施”，而不是“业务的一部分”**

---

## 2. 这个 Core Crate 是什么角色？

这个 crate 只扮演一个角色：

> **健康事实的“语言与语法定义者”**

它定义的是：

* 什么是 Subject
* 什么是 Metric
* 什么是 Observation
* 什么是 DataSource
* 这些概念之间的**结构关系与不变量**

它**不关心**：

* 这些数据怎么展示
* 怎么算趋势
* 什么算异常
* 业务要不要用

---

## 3. Core Crate 必须“不知道”的事情（红线）

为了保证长期稳定，这个 crate **必须对以下内容保持无知**：

### 3.1 对业务无知

* 不知道 UI 页面
* 不知道 API 路由
* 不知道 PM 的功能拆分
* 不知道“这是医问 App”

---

### 3.2 对解释逻辑无知

* 不包含趋势枚举（up / down / stable）
* 不包含风险等级
* 不包含“正常 / 异常”
* 不包含医学判断

---

### 3.3 对存储实现弱感知

* 不绑定具体 ORM
* 不依赖数据库连接
* 可以包含 schema 定义 / 映射结构
* 但不直接执行 IO

> 它描述“世界长什么样”，
> 而不是“世界怎么被存进去”。

---

## 4. Core Crate 必须提供什么（最低职责）

### 4.1 核心数据结构（Domain Model）

这个 crate **至少**要定义以下结构：

* `Subject`
* `Metric`
* `Observation`
* `DataSource`

这些结构：

* 语义稳定
* 字段含义不可随业务变动
* 是 **Phase A 四表模型的代码映射**

---

### 4.2 领域不变量（Invariant）

例如：

* Observation 必须绑定 Subject + Metric
* Metric 的语义一旦发布不可变更
* Observation 表示事实，不表示结论

这些约束应该：

* 写在类型系统里（能用类型就不用注释）
* 或以明确的构造规则存在

---

### 4.3 对外稳定接口（API）

Core Crate 对外只暴露：

* 构造这些领域对象的方法
* 校验规则
* 基础转换（如单位/类型的安全表示）

不暴露：

* 业务快捷函数
* UI 友好接口
* 特定场景 helper

---

## 5. 为什么不能把这些写在业务里？

这是你这个设计**最重要的一点**，而且非常“教授级”。

### 5.1 业务代码的演化速度太快

* 页面会改
* 需求会变
* PM 的理解会漂移

如果数据模型跟着业务走：

> **事实层会被不断重写历史**

---

### 5.2 数据模型需要“慢变量”

健康数据的正确建模，属于：

* 慢演进
* 高稳定
* 高责任

而业务逻辑是：

* 快演进
* 高不确定
* 可推翻

> **快变量不应定义慢变量**

---

### 5.3 独立 crate = 强制边界

把数据模型放进独立 crate，意味着：

* 架构上禁止随意修改
* 心理上提高修改成本
* 技术上形成单向依赖

这不是技术洁癖，这是**系统稳定性的物理约束**。

---

## 6. 与 Phase A（数据表设计）的关系

* **Core Crate**：
  * 定义健康数据的“语义模型”
  * 是 Phase A 表结构的**代码来源**

* **Phase A 文档**：
  * 定义健康数据的“存储模型”
  * 是 Core Crate 的**数据库映射结果**

关系是：

> **crate → schema**
> 而不是反过来。

---

## 7. 判断这个 Core Crate 是否合格的标准

你可以用这 3 条直接判断：

1. **换一个 UI / 产品，这个 crate 还能直接用吗？**
2. **10 年后回看，这些类型的含义还清楚吗？**
3. **一个新业务想用健康数据，是否只需要依赖这个 crate？**

三个都是 Yes → 设计成立。

---

## 8. 一句话总结（非常重要）

> **这个 Core Crate 不是“医问的模块”，
> 而是“医问所依赖的世界模型”。**
>
> 它存在的目的，
> 是让所有业务，都只能在同一个现实之上构建。


