# 医问 3.0 · Phase A（v2）

## 数据层执行文档

> **本文档状态**：Phase A · 可执行版本
> **目标**：
>
> * 明确数据库边界
> * 明确最小建表数量
> * 明确 ER 图的“最终形态”
>
> **读完本文档后，不需要再做任何“是否要再加表”的推理。**

---

## 0. Phase A 的唯一目标

Phase A **只解决一件事**：

> **用最少、最稳定的表结构，
> 表达“长期有效的个人健康事实”。**

Phase A **不追求**：

* 医疗完整性
* 医学专业表达
* 产品友好性

---

## 1. 核心结论

### 1.1 Phase A 的最小建表结论（必须记住）

> **医问 3.0 数据库，Phase A 阶段：**
>
> ✅ **核心表 = 4 张**
> ⚠️ **可选扩展表 = 0～2 张**
> ❌ **医疗专用表 = 0 张**

**这不是建议，是设计结论。**

---

### 1.2 这 4 张表是什么（先列清楚）

1. `subject` —— 谁的数据
2. `metric` —— 数据“是什么”
3. `observation` —— 发生了什么（事实表）
4. `data_source` —— 数据从哪里来

> **任何健康数据，都必须能完整落在这 4 张表里。**
> 如果不能，说明需求不属于 Phase A。

---

## 2. 为什么医疗知识不影响建表（关键澄清）

在数据库层面：

* 血压
* 血糖
* 心率
* 体重
* HDL / LDL

**在结构上完全等价。**

它们的共同抽象只有一句话：

> **某个主体，在某个时间，对某个指标，记录了一个值**

👉 这句话 **不包含任何医疗知识**
👉 但可以承载 **全部医疗数据**

---

## 3. 四张核心表（不可再拆）

下面这一节，可以 **直接转 ER 图**。

---

### 3.1 `subject` —— 主体表

> 表达：**“这是谁的数据”**

**字段：**

* `subject_id`（PK）
* `subject_type`（user / member / future）
* `created_at`

**设计边界：**

* 不包含健康信息
* 不包含医学属性
* 只负责身份与归属

**ER 关系：**

* `subject` 1 —— N `observation`

---

### 3.2 `metric` —— 指标定义表（最重要）

> 表达：**“这个数据在语义上是什么”**

**字段：**

* `metric_id`（PK）
* `metric_code`（全局唯一、稳定，如 `blood_pressure_systolic`）
* `metric_name`
* `unit`
* `value_type`（int / float / string）
* `status`（active / deprecated）
* `created_at`

**强制规则：**

* 新增健康指标 = **新增一行**
* ❌ 不新增表
* ❌ 不改 observation 结构

**这一张表，承担所有“医疗复杂性”，
但只以“配置数据”的形式存在。**

---

### 3.3 `observation` —— 观测事实表（核心中的核心）

> 表达：**“发生了什么事实”**

**字段：**

* `observation_id`（PK）
* `subject_id`（FK）
* `metric_id`（FK）
* `value`
* `observed_at`（事实发生时间）
* `recorded_at`（入库时间）
* `source_id`（FK，可选）

**定义一句话：**

> 一条 observation =
> “在 observed_at，subject 的 metric 的值是 value”

**这是全系统唯一的事实表。**

---

### 3.4 `data_source` —— 数据来源表

> 表达：**“这条数据从哪里来”**

**字段：**

* `source_id`（PK）
* `source_type`（manual / device / report）
* `source_name`
* `metadata`（JSON，可选）

**说明：**

* 来源 ≠ 数据含义
* 来源只做背景说明，不参与医学判断

---

## 4. 时间模型

Phase A **强制使用双时间模型**：

| 字段            | 含义       |
| ------------- | -------- |
| `observed_at` | 事实发生时间   |
| `recorded_at` | 数据进入系统时间 |

**只用一个时间字段的设计 = 不合格。**

---

## 5. 明确禁止进入数据库的内容（红线）

以下内容 **绝对不进入 Phase A 数据库**：

* 正常 / 异常
* 风险等级
* 趋势结果
* 医学结论
* 诊断信息

**原因：**

> 这些不是事实，是“解释”。

---

## 6. 可选扩展表（不是必须）

### 6.1 `metric_category`（可选）

> 指标分类（心血管 / 代谢）

* category_id
* name

**作用：**

* 只用于分组
* 不改变事实模型

---

### 6.2 `metric_alias`（可选）

> 指标别名（兼容体检报告）

* metric_id
* alias_name

---

## 7. ER 图必须呈现的最终结构

你的 ER 图 **至少要清晰表达**：

* `subject` → `observation`（1:N）
* `metric` → `observation`（1:N）
* `observation` 是事实中心
* 双时间字段存在
* `data_source` 为可选关联

> **如果 ER 图看起来像“医疗系统表”，说明建模失败。**

---

## 8. Phase A 的完成定义（落锤条件）

Phase A 在满足以下条件时，**可以直接结束**：

1. 新增任何健康指标 **不需要改表**
2. 10 年后的数据仍然语义稳定
3. UI 全部重写，数据库无需变更


---

## 9. 一句话总总结

> **Phase A 建立的是“健康事实的语法”，
> 而不是“医学知识的词典”。**
>
> 医学变化再复杂，
> 语法永远只需要这 4 张表。
