<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>终端第三步（3.0）- 指标时序展示</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 24px;
            font-weight: 500;
            color: #333;
        }

        .subtitle {
            font-size: 14px;
            color: #666;
            margin-top: 8px;
        }

        .metric-selector {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .metric-selector h2 {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
            color: #555;
        }

        .metric-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .metric-btn {
            padding: 10px 20px;
            border: 1px solid #ddd;
            background-color: #fafafa;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #555;
            transition: all 0.2s;
        }

        .metric-btn:hover {
            background-color: #f0f0f0;
        }

        .metric-btn.active {
            background-color: #4a5568;
            color: #fff;
            border-color: #4a5568;
        }

        .display-area {
            background-color: #fff;
            padding: 30px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            min-height: 400px;
        }

        .metric-info {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .metric-name {
            font-size: 20px;
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }

        .metric-unit {
            font-size: 14px;
            color: #888;
        }

        .chart-container {
            margin-top: 20px;
            position: relative;
            height: 350px;
        }

        .single-value {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
        }

        .value-display {
            font-size: 72px;
            font-weight: 300;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .value-unit {
            font-size: 18px;
            color: #888;
            margin-bottom: 20px;
        }

        .value-time {
            font-size: 14px;
            color: #999;
        }

        .no-data {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            font-size: 16px;
            color: #999;
        }

        canvas {
            display: block;
        }

        .data-points {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .data-point {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }

        .data-point:hover {
            background-color: #fafafa;
        }

        .point-time {
            color: #666;
        }

        .point-value {
            color: #4a5568;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>终端第三步（3.0）</h1>
            <p class="subtitle">健康指标时序展示</p>
        </header>

        <div class="metric-selector">
            <h2>选择指标</h2>
            <div class="metric-buttons" id="metricButtons"></div>
        </div>

        <div class="display-area" id="displayArea">
            <p class="no-data">请选择一个健康指标</p>
        </div>
    </div>

    <script>
        // Mock 数据
        const metricsData = {
            'systolic_bp': {
                name: '收缩压',
                unit: 'mmHg',
                observations: [
                    { value: 118, time: '2025-12-01 08:30' },
                    { value: 122, time: '2025-12-03 09:15' },
                    { value: 115, time: '2025-12-05 08:45' },
                    { value: 125, time: '2025-12-08 09:00' },
                    { value: 120, time: '2025-12-10 08:20' },
                    { value: 119, time: '2025-12-12 09:30' },
                    { value: 123, time: '2025-12-15 08:50' },
                    { value: 117, time: '2025-12-17 09:10' }
                ]
            },
            'blood_glucose': {
                name: '空腹血糖',
                unit: 'mmol/L',
                observations: [
                    { value: 5.2, time: '2025-12-02 07:00' },
                    { value: 5.4, time: '2025-12-05 07:10' },
                    { value: 5.1, time: '2025-12-09 07:05' },
                    { value: 5.3, time: '2025-12-12 07:15' },
                    { value: 5.5, time: '2025-12-16 07:00' }
                ]
            },
            'heart_rate': {
                name: '心率',
                unit: 'bpm',
                observations: [
                    { value: 72, time: '2025-12-18 10:00' }
                ]
            },
            'weight': {
                name: '体重',
                unit: 'kg',
                observations: []
            },
            'cholesterol': {
                name: '总胆固醇',
                unit: 'mmol/L',
                observations: [
                    { value: 4.8, time: '2025-11-15 09:00' },
                    { value: 4.6, time: '2025-12-15 09:00' }
                ]
            },
            'hdl': {
                name: '高密度脂蛋白',
                unit: 'mmol/L',
                observations: [
                    { value: 1.2, time: '2025-11-15 09:00' },
                    { value: 1.3, time: '2025-12-15 09:00' }
                ]
            }
        };

        // 初始化指标按钮
        function initMetricButtons() {
            const container = document.getElementById('metricButtons');
            Object.keys(metricsData).forEach(key => {
                const btn = document.createElement('button');
                btn.className = 'metric-btn';
                btn.textContent = metricsData[key].name;
                btn.onclick = () => selectMetric(key);
                container.appendChild(btn);
            });
        }

        // 选择指标
        function selectMetric(metricKey) {
            // 更新按钮状态
            document.querySelectorAll('.metric-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // 显示数据
            displayMetric(metricKey);
        }

        // 显示指标数据
        function displayMetric(metricKey) {
            const metric = metricsData[metricKey];
            const displayArea = document.getElementById('displayArea');

            if (metric.observations.length === 0) {
                // 无数据
                displayArea.innerHTML = '<p class="no-data">暂无数据</p>';
            } else if (metric.observations.length === 1) {
                // 单条数据
                const obs = metric.observations[0];
                displayArea.innerHTML = `
                    <div class="metric-info">
                        <div class="metric-name">${metric.name}</div>
                        <div class="metric-unit">单位：${metric.unit}</div>
                    </div>
                    <div class="single-value">
                        <div class="value-display">${obs.value}</div>
                        <div class="value-unit">${metric.unit}</div>
                        <div class="value-time">观测时间：${obs.time}</div>
                    </div>
                `;
            } else {
                // 多条数据 - 显示图表
                displayArea.innerHTML = `
                    <div class="metric-info">
                        <div class="metric-name">${metric.name}</div>
                        <div class="metric-unit">单位：${metric.unit}</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="metricChart"></canvas>
                    </div>
                    <div class="data-points" id="dataPoints"></div>
                `;

                drawChart(metric);
                displayDataPoints(metric);
            }
        }

        // 绘制图表
        function drawChart(metric) {
            const canvas = document.getElementById('metricChart');
            const ctx = canvas.getContext('2d');
            const container = canvas.parentElement;

            // 设置 canvas 尺寸
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;

            const padding = { top: 20, right: 30, bottom: 60, left: 60 };
            const chartWidth = canvas.width - padding.left - padding.right;
            const chartHeight = canvas.height - padding.top - padding.bottom;

            const values = metric.observations.map(o => o.value);
            const minValue = Math.min(...values);
            const maxValue = Math.max(...values);
            const valueRange = maxValue - minValue || 1;
            const valuePadding = valueRange * 0.1;

            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 绘制网格线
            ctx.strokeStyle = '#e5e5e5';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(padding.left + chartWidth, y);
                ctx.stroke();
            }

            // 绘制 Y 轴刻度
            ctx.fillStyle = '#666';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const value = maxValue + valuePadding - (valueRange + 2 * valuePadding) / 5 * i;
                const y = padding.top + (chartHeight / 5) * i;
                ctx.fillText(value.toFixed(1), padding.left - 10, y + 4);
            }

            // 绘制折线
            ctx.strokeStyle = '#4a5568';
            ctx.lineWidth = 2;
            ctx.beginPath();

            metric.observations.forEach((obs, index) => {
                const x = padding.left + (chartWidth / (metric.observations.length - 1)) * index;
                const normalizedValue = (obs.value - (minValue - valuePadding)) / (valueRange + 2 * valuePadding);
                const y = padding.top + chartHeight - (normalizedValue * chartHeight);

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // 绘制数据点
            metric.observations.forEach((obs, index) => {
                const x = padding.left + (chartWidth / (metric.observations.length - 1)) * index;
                const normalizedValue = (obs.value - (minValue - valuePadding)) / (valueRange + 2 * valuePadding);
                const y = padding.top + chartHeight - (normalizedValue * chartHeight);

                ctx.fillStyle = '#4a5568';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();

                // 绘制数值标签
                ctx.fillStyle = '#333';
                ctx.font = '11px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(obs.value, x, y - 10);
            });

            // 绘制 X 轴时间标签
            ctx.fillStyle = '#666';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';
            metric.observations.forEach((obs, index) => {
                const x = padding.left + (chartWidth / (metric.observations.length - 1)) * index;
                const timeLabel = obs.time.split(' ')[0].substring(5); // 提取 MM-DD
                ctx.save();
                ctx.translate(x, canvas.height - 15);
                ctx.rotate(-Math.PI / 6);
                ctx.fillText(timeLabel, 0, 0);
                ctx.restore();
            });
        }

        // 显示数据点列表
        function displayDataPoints(metric) {
            const container = document.getElementById('dataPoints');
            container.innerHTML = '';

            metric.observations.slice().reverse().forEach(obs => {
                const div = document.createElement('div');
                div.className = 'data-point';
                div.innerHTML = `
                    <span class="point-time">${obs.time}</span>
                    <span class="point-value">${obs.value} ${metric.unit}</span>
                `;
                container.appendChild(div);
            });
        }

        // 初始化
        initMetricButtons();
    </script>
</body>
</html>
